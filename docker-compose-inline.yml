# ====================================
# DOCKER COMPOSE - Ain'tonio Discord Bot
# Variables de entorno inline (sin .env)
# ====================================

version: '3.8'

services:
  # ====================================
  # SERVICIO PRINCIPAL DEL BOT
  # ====================================
  discord-bot:
    image: raztor/aintonio-bot:latest
    container_name: aintonio-discord-bot
    restart: unless-stopped

    # ====================================
    # VARIABLES DE ENTORNO INLINE
    # ====================================
    environment:
      # ====================================
      # CONFIGURACI√ìN OBLIGATORIA DEL BOT
      # ====================================
      # ‚ö†Ô∏è CAMBIAR ESTOS VALORES ‚ö†Ô∏è
      DISCORD_TOKEN: "your_discord_bot_token_here"           # ‚Üê REQUERIDO: Token del bot
      GUILD_ID: "your_guild_id_here"                         # ‚Üê RECOMENDADO: ID del servidor

      # ====================================
      # CONFIGURACI√ìN GENERAL
      # ====================================
      ENVIRONMENT: "production"
      LOG_LEVEL: "INFO"
      COMMAND_PREFIX: "!"

      # ====================================
      # CONFIGURACI√ìN DE CANALES
      # ====================================
      MOD_LOG_CHANNEL_ID: ""                                 # ‚Üê ID del canal de logs de moderaci√≥n
      WELCOME_CHANNEL_ID: ""                                 # ‚Üê ID del canal de bienvenida

      # ====================================
      # CONFIGURACI√ìN DE ROLES
      # ====================================
      ADMIN_ROLE_IDS: ""                                     # ‚Üê IDs de roles admin (separados por comas)
      MOD_ROLE_IDS: ""                                       # ‚Üê IDs de roles moderador (separados por comas)
      MEMBER_ROLE_ID: ""                                     # ‚Üê ID del rol de miembro

      # ====================================
      # CONFIGURACI√ìN DE CANALES DIN√ÅMICOS
      # ====================================
      DYNAMIC_VOICE_TRIGGER_NAMES: "üîß Crear Canal,Crear Canal,‚ûï Crear Canal"
      DYNAMIC_VOICE_CHANNEL_PREFIX: "üí¨ Canal de"
      DYNAMIC_VOICE_CLEANUP_DELAY: "10"
      DYNAMIC_VOICE_CLEANUP_INTERVAL: "5"

      # ====================================
      # CONFIGURACI√ìN DOCKER
      # ====================================
      PYTHONUNBUFFERED: "1"
      PYTHONPATH: "/app/src"
      TZ: "America/Santiago"
      PUID: "1000"
      PGID: "1000"

    # ====================================
    # VOL√öMENES DE DOCKER
    # ====================================
    volumes:
      - bot_logs:/app/logs
      - bot_data:/app/data
      - bot_resources:/app/src/resources

    # ====================================
    # CONFIGURACI√ìN DE RED
    # ====================================
    networks:
      - bot-network

    # ====================================
    # CONFIGURACI√ìN DE LOGGING
    # ====================================
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # ====================================
    # HEALTH CHECK
    # ====================================
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.path.insert(0, '/app/src'); from config.settings import get_settings; get_settings().validate()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    # ====================================
    # RECURSOS (OPCIONAL)
    # ====================================
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '0.5'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.1'
    #       memory: 128M

# ====================================
# CONFIGURACI√ìN OPCIONAL: WATCHTOWER
# (Auto-actualizaci√≥n de im√°genes)
# ====================================
  # watchtower:
  #   image: containrrr/watchtower
  #   container_name: aintonio-watchtower
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock
  #   environment:
  #     - WATCHTOWER_CLEANUP=true
  #     - WATCHTOWER_INCLUDE_STOPPED=true
  #     - WATCHTOWER_SCHEDULE=0 0 2 * * *  # Diario a las 2 AM
  #     - WATCHTOWER_MONITOR_ONLY=true
  #   networks:
  #     - bot-network

# ====================================
# REDES
# ====================================
networks:
  bot-network:
    driver: bridge
    name: aintonio-network

# ====================================
# VOL√öMENES DE DOCKER
# ====================================
volumes:
  bot_logs:
    driver: local
    name: aintonio_logs
  bot_data:
    driver: local
    name: aintonio_data
  bot_resources:
    driver: local
    name: aintonio_resources